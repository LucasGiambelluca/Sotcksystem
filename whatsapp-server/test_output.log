 DEPRECATED  `test.poolOptions` was removed in Vitest 4. All previous `poolOptions` are now top-level options. Please, refer to the migration guide: https://vitest.dev/guide/migration#pool-rework

[1m[46m RUN [49m[22m [36mv4.0.18 [39m[90mC:/Users/Lucas/Desktop/Sotcksystem/whatsapp-server[39m

[90mstdout[2m | src/__tests__/unit/OrderService.test.ts
[22m[39m[dotenv@17.3.1] injecting env (2) from .env -- tip: Ã”ÃœÃ–Â´Â©Ã…  override existing env vars with { override: true }

[90mstdout[2m | src/__tests__/unit/OrderService.test.ts
[22m[39mÃ”Â£Ã  Redis Connected

stderr | src/__tests__/unit/OrderService.test.ts
[ioredis] Unhandled error event: Error: connect ECONNREFUSED ::1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1615:16)

stderr | src/__tests__/unit/OrderService.test.ts
[ioredis] Unhandled error event: Error: connect ECONNREFUSED ::1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1615:16)

stderr | src/__tests__/unit/OrderService.test.ts
[ioredis] Unhandled error event: Error: connect ECONNREFUSED ::1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1615:16)

stderr | src/__tests__/unit/OrderService.test.ts
[ioredis] Unhandled error event: Error: connect ECONNREFUSED ::1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1615:16)

stderr | src/__tests__/unit/OrderService.test.ts
[ioredis] Unhandled error event: Error: connect ECONNREFUSED ::1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1615:16)

stderr | src/__tests__/unit/OrderService.test.ts > OrderService > debe crear un pedido y sus items correctamente
[ioredis] Unhandled error event: Error: connect ECONNREFUSED ::1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1615:16)

stderr | src/__tests__/unit/OrderService.test.ts > OrderService > debe crear un pedido y sus items correctamente
[ioredis] Unhandled error event: Error: connect ECONNREFUSED ::1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1615:16)

stderr | src/__tests__/unit/OrderService.test.ts > OrderService > debe crear un pedido y sus items correctamente
[ioredis] Unhandled error event: Error: connect ECONNREFUSED ::1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1615:16)

stderr | src/__tests__/unit/OrderService.test.ts > OrderService > debe crear un pedido y sus items correctamente
[ioredis] Unhandled error event: Error: connect ECONNREFUSED ::1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1615:16)

stderr | src/__tests__/unit/OrderService.test.ts > OrderService > debe crear un pedido y sus items correctamente
[ioredis] Unhandled error event: Error: connect ECONNREFUSED ::1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1615:16)

stderr | src/__tests__/unit/OrderService.test.ts > OrderService > debe crear un pedido y sus items correctamente
[ioredis] Unhandled error event: Error: connect ECONNREFUSED ::1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1615:16)

stderr | src/__tests__/unit/OrderService.test.ts > OrderService > debe crear un pedido y sus items correctamente
[ioredis] Unhandled error event: Error: connect ECONNREFUSED ::1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1615:16)

stderr | src/__tests__/unit/OrderService.test.ts > OrderService > debe crear un pedido y sus items correctamente
[ioredis] Unhandled error event: Error: connect ECONNREFUSED ::1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1615:16)

stderr | src/__tests__/unit/OrderService.test.ts > OrderService > debe crear un pedido y sus items correctamente
[ioredis] Unhandled error event: Error: connect ECONNREFUSED ::1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1615:16)

stderr | src/__tests__/unit/OrderService.test.ts > OrderService > debe fallar si el slot no tiene disponibilidad
[ioredis] Unhandled error event: Error: connect ECONNREFUSED ::1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1615:16)

stderr | src/__tests__/unit/OrderService.test.ts > OrderService > debe fallar si el slot no tiene disponibilidad
[ioredis] Unhandled error event: Error: connect ECONNREFUSED ::1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1615:16)

stderr | src/__tests__/unit/OrderService.test.ts > OrderService > debe fallar si el slot no tiene disponibilidad
[ioredis] Unhandled error event: Error: connect ECONNREFUSED ::1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1615:16)

stderr | src/__tests__/unit/OrderService.test.ts > OrderService > debe asignar automâ”œÃ­ticamente a un preparador si hay uno disponible
[ioredis] Unhandled error event: Error: connect ECONNREFUSED ::1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1615:16)

stderr | src/__tests__/unit/OrderService.test.ts > OrderService > debe asignar automâ”œÃ­ticamente a un preparador si hay uno disponible
[ioredis] Unhandled error event: Error: connect ECONNREFUSED ::1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1615:16)

stderr | src/__tests__/unit/OrderService.test.ts > OrderService > debe asignar automâ”œÃ­ticamente a un preparador si hay uno disponible
[ioredis] Unhandled error event: Error: connect ECONNREFUSED ::1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1615:16)

stderr | src/__tests__/unit/OrderService.test.ts > OrderService > debe asignar automâ”œÃ­ticamente a un preparador si hay uno disponible
[ioredis] Unhandled error event: Error: connect ECONNREFUSED ::1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1615:16)

stderr | src/__tests__/unit/OrderService.test.ts > OrderService > debe asignar automâ”œÃ­ticamente a un preparador si hay uno disponible
[ioredis] Unhandled error event: Error: connect ECONNREFUSED ::1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1615:16)

stderr | src/__tests__/unit/OrderService.test.ts > OrderService > debe asignar automâ”œÃ­ticamente a un preparador si hay uno disponible
[OrderService] Error en auto-asignaciâ”œâ”‚n: {
  code: 'PGRST204',
  details: null,
  hint: null,
  message: "Could not find the 'assigned_at' column of 'orders' in the schema cache"
}

 [31mÃ”Ã˜Â»[39m src/__tests__/unit/OrderService.test.ts [2m([22m[2m3 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[33m 11427[2mms[22m[39m
[31m     [31mâ”œÃ¹[31m debe crear un pedido y sus items correctamente[39m[33m 4098[2mms[22m[39m
     [33m[2mÃ”Â£Ã´[22m[39m debe fallar si el slot no tiene disponibilidad [33m 2761[2mms[22m[39m
[31m     [31mâ”œÃ¹[31m debe asignar automâ”œÃ­ticamente a un preparador si hay uno disponible[39m[33m 4564[2mms[22m[39m

Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â» Failed Tests 2 Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»

 FAIL  src/__tests__/unit/OrderService.test.ts > OrderService > debe crear un pedido y sus items correctamente
Error: Error creando orden: invalid input syntax for type bigint: "00000000-0000-0000-0000-000000000002"
 Ã”Ã˜Â» OrderService.createOrder src/services/OrderService.ts:81:19
     79|             // Rollback del slot si falla la orden
     80|             if (deliverySlotId) await this.slotService.releaseSlot(delÃ”Ã‡Âª
     81|             throw new Error(`Error creando orden: ${orderError.messageÃ”Ã‡Âª
       |                   ^
     82|         }
     83| 
 Ã”Ã˜Â» src/__tests__/unit/OrderService.test.ts:53:23

Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»[1/2]Ã”Ã„Â»

 FAIL  src/__tests__/unit/OrderService.test.ts > OrderService > debe asignar automâ”œÃ­ticamente a un preparador si hay uno disponible
AssertionError: expected null to be '9ec59cfa-7aad-43a9-ae41-c0bda844b8af' // Object.is equality

- Expected: 
"9ec59cfa-7aad-43a9-ae41-c0bda844b8af"

+ Received: 
null

 Ã”Ã˜Â» src/__tests__/unit/OrderService.test.ts:103:36
    101| 
    102|         const assignedPreparerId = await orderService.autoAssignOrder(Ã”Ã‡Âª
    103|         expect(assignedPreparerId).toBe(preparer.id);
       |                                    ^
    104| 
    105|         const { data: updatedOrder } = await testSupabase

Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»[2/2]Ã”Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m2 failed[39m[22m[2m | [22m[1m[32m1 passed[39m[22m[90m (3)[39m
[2m   Start at [22m 12:24:11
[2m   Duration [22m 13.63s[2m (transform 121ms, setup 342ms, import 1.48s, tests 11.43s, environment 0ms)[22m

