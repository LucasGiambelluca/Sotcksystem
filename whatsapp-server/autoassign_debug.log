 DEPRECATED  `test.poolOptions` was removed in Vitest 4. All previous `poolOptions` are now top-level options. Please, refer to the migration guide: https://vitest.dev/guide/migration#pool-rework

[1m[46m RUN [49m[22m [36mv4.0.18 [39m[90mC:/Users/Lucas/Desktop/Sotcksystem/whatsapp-server[39m

[90mstdout[2m | src/__tests__/unit/OrderService.test.ts
[22m[39m[dotenv@17.3.1] injecting env (2) from .env -- tip: Â­Æ’Ã±Ã» agentic secret storage: https://dotenvx.com/as2

[90mstdout[2m | src/__tests__/unit/OrderService.test.ts
[22m[39mÃ”Â£Ã  Redis Connected

stderr | src/__tests__/unit/OrderService.test.ts
[ioredis] Unhandled error event: Error: connect ECONNREFUSED ::1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1615:16)

stderr | src/__tests__/unit/OrderService.test.ts
[ioredis] Unhandled error event: Error: connect ECONNREFUSED ::1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1615:16)

stderr | src/__tests__/unit/OrderService.test.ts
[ioredis] Unhandled error event: Error: connect ECONNREFUSED ::1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1615:16)

stderr | src/__tests__/unit/OrderService.test.ts
[ioredis] Unhandled error event: Error: connect ECONNREFUSED ::1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1615:16)

stderr | src/__tests__/unit/OrderService.test.ts
[ioredis] Unhandled error event: Error: connect ECONNREFUSED ::1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1615:16)

stderr | src/__tests__/unit/OrderService.test.ts > OrderService > debe crear un pedido y sus items correctamente
[ioredis] Unhandled error event: Error: connect ECONNREFUSED ::1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1615:16)

stderr | src/__tests__/unit/OrderService.test.ts > OrderService > debe crear un pedido y sus items correctamente
[ioredis] Unhandled error event: Error: connect ECONNREFUSED ::1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1615:16)

stderr | src/__tests__/unit/OrderService.test.ts > OrderService > debe crear un pedido y sus items correctamente
[ioredis] Unhandled error event: Error: connect ECONNREFUSED ::1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1615:16)

stderr | src/__tests__/unit/OrderService.test.ts > OrderService > debe crear un pedido y sus items correctamente
[ioredis] Unhandled error event: Error: connect ECONNREFUSED ::1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1615:16)

stderr | src/__tests__/unit/OrderService.test.ts > OrderService > debe crear un pedido y sus items correctamente
[ioredis] Unhandled error event: Error: connect ECONNREFUSED ::1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1615:16)

stderr | src/__tests__/unit/OrderService.test.ts > OrderService > debe crear un pedido y sus items correctamente
[ioredis] Unhandled error event: Error: connect ECONNREFUSED ::1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1615:16)

stderr | src/__tests__/unit/OrderService.test.ts > OrderService > debe crear un pedido y sus items correctamente
[ioredis] Unhandled error event: Error: connect ECONNREFUSED ::1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1615:16)

stderr | src/__tests__/unit/OrderService.test.ts > OrderService > debe crear un pedido y sus items correctamente
[ioredis] Unhandled error event: Error: connect ECONNREFUSED ::1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1615:16)

stderr | src/__tests__/unit/OrderService.test.ts > OrderService > debe fallar si el slot no tiene disponibilidad
[ioredis] Unhandled error event: Error: connect ECONNREFUSED ::1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1615:16)

stderr | src/__tests__/unit/OrderService.test.ts > OrderService > debe fallar si el slot no tiene disponibilidad
[ioredis] Unhandled error event: Error: connect ECONNREFUSED ::1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1615:16)

stderr | src/__tests__/unit/OrderService.test.ts > OrderService > debe fallar si el slot no tiene disponibilidad
[ioredis] Unhandled error event: Error: connect ECONNREFUSED ::1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1615:16)

stderr | src/__tests__/unit/OrderService.test.ts > OrderService > debe fallar si el slot no tiene disponibilidad
[ioredis] Unhandled error event: Error: connect ECONNREFUSED ::1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1615:16)

stderr | src/__tests__/unit/OrderService.test.ts > OrderService > debe asignar automâ”œÃ­ticamente a un preparador si hay uno disponible
[ioredis] Unhandled error event: Error: connect ECONNREFUSED ::1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1615:16)

stderr | src/__tests__/unit/OrderService.test.ts > OrderService > debe asignar automâ”œÃ­ticamente a un preparador si hay uno disponible
[ioredis] Unhandled error event: Error: connect ECONNREFUSED ::1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1615:16)

stderr | src/__tests__/unit/OrderService.test.ts > OrderService > debe asignar automâ”œÃ­ticamente a un preparador si hay uno disponible
[ioredis] Unhandled error event: Error: connect ECONNREFUSED ::1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1615:16)

stderr | src/__tests__/unit/OrderService.test.ts > OrderService > debe asignar automâ”œÃ­ticamente a un preparador si hay uno disponible
[ioredis] Unhandled error event: Error: connect ECONNREFUSED ::1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1615:16)

stderr | src/__tests__/unit/OrderService.test.ts > OrderService > debe asignar automâ”œÃ­ticamente a un preparador si hay uno disponible
[ioredis] Unhandled error event: Error: connect ECONNREFUSED ::1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1615:16)

[90mstdout[2m | src/__tests__/unit/OrderService.test.ts[2m > [22m[2mOrderService[2m > [22m[2mdebe asignar automâ”œÃ­ticamente a un preparador si hay uno disponible
[22m[39m[OrderService] Found 1 preparers for auto-assignment.

stderr | src/__tests__/unit/OrderService.test.ts > OrderService > debe asignar automâ”œÃ­ticamente a un preparador si hay uno disponible
[ioredis] Unhandled error event: Error: connect ECONNREFUSED ::1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1615:16)

stderr | src/__tests__/unit/OrderService.test.ts > OrderService > debe asignar automâ”œÃ­ticamente a un preparador si hay uno disponible
[OrderService] Error en auto-asignaciâ”œâ”‚n: {
  code: '22P02',
  details: null,
  hint: null,
  message: 'invalid input value for enum order_status: "ASSIGNED"'
}

 [31mÃ”Ã˜Â»[39m src/__tests__/unit/OrderService.test.ts [2m([22m[2m3 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[33m 12529[2mms[22m[39m
[31m     [31mâ”œÃ¹[31m debe crear un pedido y sus items correctamente[39m[33m 3479[2mms[22m[39m
     [33m[2mÃ”Â£Ã´[22m[39m debe fallar si el slot no tiene disponibilidad [33m 3479[2mms[22m[39m
[31m     [31mâ”œÃ¹[31m debe asignar automâ”œÃ­ticamente a un preparador si hay uno disponible[39m[33m 5567[2mms[22m[39m

Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â» Failed Tests 2 Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»

 FAIL  src/__tests__/unit/OrderService.test.ts > OrderService > debe crear un pedido y sus items correctamente
Error: Lo sentimos, el horario elegido ya no tiene cupo disponible.
 Ã”Ã˜Â» OrderService.createOrder src/services/OrderService.ts:56:23
     54|             const reserved = await this.slotService.reserveSlot(deliveÃ”Ã‡Âª
     55|             if (!reserved) {
     56|                 throw new Error('Lo sentimos, el horario elegido ya noÃ”Ã‡Âª
       |                       ^
     57|             }
     58|         }
 Ã”Ã˜Â» src/__tests__/unit/OrderService.test.ts:53:23

Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»[1/2]Ã”Ã„Â»

 FAIL  src/__tests__/unit/OrderService.test.ts > OrderService > debe asignar automâ”œÃ­ticamente a un preparador si hay uno disponible
AssertionError: expected null to be 'f769b5be-c798-4fe9-8174-f324fbf5afb2' // Object.is equality

- Expected: 
"f769b5be-c798-4fe9-8174-f324fbf5afb2"

+ Received: 
null

 Ã”Ã˜Â» src/__tests__/unit/OrderService.test.ts:112:36
    110|         // 4. Asignar
    111|         const assignedPreparerId = await orderService.autoAssignOrder(Ã”Ã‡Âª
    112|         expect(assignedPreparerId).toBe(preparer.id);
       |                                    ^
    113| 
    114|         const { data: updatedOrder } = await testSupabase

Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»Ã”Ã„Â»[2/2]Ã”Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m2 failed[39m[22m[2m | [22m[1m[32m1 passed[39m[22m[90m (3)[39m
[2m   Start at [22m 12:37:45
[2m   Duration [22m 14.58s[2m (transform 122ms, setup 310ms, import 1.31s, tests 12.53s, environment 0ms)[22m

